# –ü—Ä–µ—Ä—ã–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ
set -e

# --- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ---
# –ò–º—è –≤–∞—à–µ–≥–æ Key Vault. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–∞–∫ –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç —Å–∫—Ä–∏–ø—Ç–∞.
# –ü—Ä–∏–º–µ—Ä: ./set_secrets.sh my-custom-vault-name
KEY_VAULT_NAME="${1:-marketflow-vault}"

# –°–ø–∏—Å–æ–∫ –∏–º–µ–Ω —Å–µ–∫—Ä–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å.
# –°–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å —Ç–∞–∫–∏–º–∏ –∂–µ –∏–º–µ–Ω–∞–º–∏.
SECRET_NAMES=(
  "SNOWFLAKE-PASSWORD"
  "SNOWFLAKE-CONNECTION-STRING"
  "KAFKA-CONNECTION-STRING"
  # –î–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞ –¥—Ä—É–≥–∏–µ —Å–µ–∫—Ä–µ—Ç—ã –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:
  "BINANCE-API-KEY"
  "BINANCE-API-SECRET"
  "TELEGRAM-TOKEN"
)
# --- –ö–æ–Ω–µ—Ü –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ---


echo "üîë –ù–∞—á–∏–Ω–∞—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ Key Vault: $KEY_VAULT_NAME"
echo "--------------------------------------------------"

for SECRET_NAME in "${SECRET_NAMES[@]}"; do
  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–º—è —Å–µ–∫—Ä–µ—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è (–∑–∞–º–µ–Ω—è–µ–º '-' –Ω–∞ '_')
  ENV_VAR_NAME=$(echo "$SECRET_NAME" | tr '-' '_')
  # –ö–æ—Å–≤–µ–Ω–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–æ –µ–µ –∏–º–µ–Ω–∏
  SECRET_VALUE="${!ENV_VAR_NAME}"

  if [ -z "$SECRET_VALUE" ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è '$ENV_VAR_NAME' –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –ü—Ä–æ–ø—É—Å–∫–∞—é."
    exit 1
  else
    echo " -> –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Å–µ–∫—Ä–µ—Ç –¥–ª—è '$SECRET_NAME'..."
    az keyvault secret set \
      --vault-name "$KEY_VAULT_NAME" \
      --name "$SECRET_NAME" \
      --value "$SECRET_VALUE" \
      --output none # –ü–æ–¥–∞–≤–ª—è–µ–º –≤—ã–≤–æ–¥, —á—Ç–æ–±—ã —Å–∞–º —Å–µ–∫—Ä–µ—Ç –Ω–µ –ø–æ–ø–∞–ª –≤ –ª–æ–≥–∏
    echo "‚úÖ –°–µ–∫—Ä–µ—Ç '$SECRET_NAME' —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."
  fi
done

echo "--------------------------------------------------"
echo "üéâ –í—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã."